import{_ as J,u as K,r as u,f as O,g as D,o as _,w as t,E as Q,b as l,h as W,i as X,a as s,j as Y,k as V,l as o,d as f,t as y,n as Z,c as v,F as ee,m as le}from"./B00Sa7sD.js";import{E as te,a as oe,b as ne,c as ae,d as se,e as ie,f as de}from"./CmBcCHSD.js";import{E as re}from"./CD4XycvD.js";import{E as ue}from"./IdgKBxvE.js";const pe={style:{color:"black"}},me=["infinite-scroll-disabled"],fe={style:{width:"160px",height:"160px"}},ce=["onClick"],_e={style:{"line-height":"24px","padding-top":"5px"}},ge={style:{display:"flex",height:"24px","overflow-y":"hidden"}},he={style:{"flex-grow":"1"}},ye={style:{"text-align":"right"}},be={style:{display:"flex"}},we={key:0},xe={key:1},Ve={slot:"footer",class:"dialog-footer"},ve={__name:"album",setup(ke){K({title:"印花相册"});const k=typeof window<"u"?window.browser??window.top?.browser:null,C=k?.pouchdb,p=u({_id:"",name:"",owner:"",description:""}),g=u([]),a=u({}),b=u(!1),S=u(!1),z=u(!0);u([]),u(!1);const A=u(!1),E=u(1),I=u(1),$=u(!1);O(async()=>{if(!k||!C){g.value=[];return}const d={_id:{$exists:!0}};try{const m=(await C.find("albums",{selector:d})).result.docs;g.value=m}catch(e){console.error("获取相册数据失败:",e),g.value=[]}});function N(){a.value={_id:"",code:"",path:""},S.value=!0,b.value=!0}async function P(){a.value.code=a.value._id;try{const e=(await axios.post("album/create",this.current)).data;e.ok&&(this.current._rev=e.rev,this.albums.unshift(this.current)),this.$message({type:"success",message:"更新成功"}),this.editFormVisible=!1}catch(d){if(d.name=="conflict"){this.$message({type:"error",message:"相册短代码/ID冲突，请使用新的短代码"});return}return this.$message({type:"error",message:"更新出错，请稍后重试"})}}async function F(){typeof window>"u"||(this.currentPage=1,this.isInfiniteScrollDisabled=!1,this.handleLoadAlbums())}async function B(d){typeof window>"u"||this.handleLoadAlbums(d)}function L(d){if(typeof window>"u")return;const e="view/album/detail.html?id="+d._id,m=`${d._id} - ${d.name} - 相册详情`;openNewTab(m,e)}async function M(){if(typeof window>"u")return;const d=await axios.get("/dialog/selectDirectory");this.current.path=d.data}async function H(){if(!(typeof window>"u")){for(let d in this.params)this.params[d]="";this.currentPage=1,this.handleLoadAlbums()}}return(d,e)=>{const m=X,r=ne,i=oe,h=re,w=te,U=Y,x=Q,T=W,j=se,c=ae,G=de,R=ie,q=ue;return _(),D(x,{style:{height:"100%"},class:"content"},{default:t(()=>[l(T,{width:"270px",style:{"background-color":"white"}},{default:t(()=>[l(x,null,{default:t(()=>[l(m,{height:"39px",style:{"border-bottom":"1px solid #eee",display:"flex","flex-direction":"row"}},{default:t(()=>[e[16]||(e[16]=s("div",{style:{"line-height":"39px","font-size":"14px","flex-grow":"1"}},"印花相册",-1)),s("div",{style:{width:"20px","line-height":"39px"}},[s("i",{onClick:N,class:"el-icon el-icon-plus",style:{"font-size":"16px",cursor:"pointer"}})])]),_:1,__:[16]}),l(U,{style:{padding:"10px 10px 10px 10px"}},{default:t(()=>[l(w,{size:"small",onSubmit:e[4]||(e[4]=V(()=>{},["prevent"])),"label-width":"68px","label-position":"right"},{default:t(()=>[l(i,{label:"短代码"},{default:t(()=>[l(r,{modelValue:o(p).id,"onUpdate:modelValue":e[0]||(e[0]=n=>o(p).id=n),placeholder:"相册ID"},null,8,["modelValue"])]),_:1}),l(i,{label:"名称"},{default:t(()=>[l(r,{modelValue:o(p).name,"onUpdate:modelValue":e[1]||(e[1]=n=>o(p).name=n),placeholder:"相册名称或者标题"},null,8,["modelValue"])]),_:1}),l(i,{label:"关联客户"},{default:t(()=>[l(r,{modelValue:o(p).owner,"onUpdate:modelValue":e[2]||(e[2]=n=>o(p).owner=n),placeholder:"客户名称或代码"},null,8,["modelValue"])]),_:1}),l(i,{label:"描述"},{default:t(()=>[l(r,{modelValue:o(p).description,"onUpdate:modelValue":e[3]||(e[3]=n=>o(p).description=n),placeholder:"描述"},null,8,["modelValue"])]),_:1}),l(i,{label:" "},{default:t(()=>[l(h,{plain:"",onClick:F},{default:t(()=>e[17]||(e[17]=[f("搜索",-1)])),_:1,__:[17]}),l(h,{onClick:H},{default:t(()=>e[18]||(e[18]=[f("清空",-1)])),_:1,__:[18]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(x,{style:{"margin-left":"10px"}},{default:t(()=>[l(m,{class:"content-header",id:"frame-header",height:"40px",shadow:"always"},{default:t(()=>[l(c,{span:14},{default:t(()=>[l(w,{inline:!0,size:"mini",onSubmit:e[5]||(e[5]=V(()=>{},["prevent"]))},{default:t(()=>[l(i,null,{default:t(()=>[l(j,{small:"",layout:"prev, next","current-page":o(E),onCurrentChange:B,total:100,"page-count":o(I),disabled:o($)},null,8,["current-page","page-count","disabled"])]),_:1}),l(i,null,{default:t(()=>[s("span",pe,"第 "+y(o(E))+" 页",1)]),_:1})]),_:1})]),_:1}),l(c,{span:10})]),_:1}),l(U,{id:"frame-main",class:Z({loading:o(z)})},{default:t(()=>[s("div",{style:{width:"100%",display:"block",background:"rgb(244, 244, 245)"},"infinite-scroll-distance":"40px","infinite-scroll-disabled":o(A)},[(_(!0),v(ee,null,le(o(g),(n,Ce)=>(_(),D(R,{style:{display:"inline-block",width:"180px",height:"220px","margin-right":"10px","margin-top":"10px"},"body-style":{padding:"10px"}},{default:t(()=>[s("div",fe,[s("a",{href:"#",onClick:V(Ee=>L(n),["prevent"])},[l(G,{src:n.cover_image,fit:"fill",style:{width:"100%",height:"100%"},lazy:"",crossorigin:"anonymous"},{default:t(()=>e[19]||(e[19]=[s("div",{slot:"placeholder",class:"image-slot"},[f(" 加载中"),s("span",{class:"dot"},"...")],-1)])),_:2,__:[19]},1032,["src"])],8,ce)]),s("div",_e,[s("div",ge,[s("div",he,y(n.name),1),s("div",ye,y(n._id),1)]),s("div",be,[n.updated_at?(_(),v("div",we,y(n.updated_at.substr(0,10)),1)):(_(),v("div",xe,"1970-01-01")),e[20]||(e[20]=s("div",{style:{"flex-grow":"1",color:"#999","text-align":"right"}},"本地",-1))])])]),_:2},1024))),256)),e[21]||(e[21]=s("div",{style:{width:"100%",height:"10px"}},null,-1))],8,me)]),_:1},8,["class"])]),_:1}),l(q,{title:"新建相册",visible:o(b),width:"680px"},{default:t(()=>[l(w,{ref:"edit-form",model:o(a),"label-width":"90px",size:"mini"},{default:t(()=>[l(c,{span:11},{default:t(()=>[l(i,{label:"短代码"},{default:t(()=>[l(r,{modelValue:o(a)._id,"onUpdate:modelValue":e[6]||(e[6]=n=>o(a)._id=n),placeholder:"必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:"相册名称"},{default:t(()=>[l(r,{modelValue:o(a).name,"onUpdate:modelValue":e[7]||(e[7]=n=>o(a).name=n),placeholder:"必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:"关联客户"},{default:t(()=>[l(r,{modelValue:o(a).owner,"onUpdate:modelValue":e[8]||(e[8]=n=>o(a).owner=n),placeholder:"非必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:"客户公司"},{default:t(()=>[l(r,{modelValue:o(a).owner_company,"onUpdate:modelValue":e[9]||(e[9]=n=>o(a).owner_company=n),placeholder:"非必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:"关联账号"},{default:t(()=>[l(r,{modelValue:o(a).associated_account,"onUpdate:modelValue":e[10]||(e[10]=n=>o(a).associated_account=n),placeholder:"非必填项"},null,8,["modelValue"])]),_:1})]),_:1}),l(c,{span:2},{default:t(()=>e[22]||(e[22]=[f(" ",-1)])),_:1,__:[22]}),l(c,{span:11},{default:t(()=>[l(i,{label:"文件夹"},{default:t(()=>[l(r,{modelValue:o(a).path,"onUpdate:modelValue":e[11]||(e[11]=n=>o(a).path=n),placeholder:"点击右侧按钮选择文件夹",readonly:!0},{default:t(()=>[s("i",{slot:"suffix",title:"选择文件夹",class:"el-icon-folder-opened el-input__icon",onClick:M,style:{cursor:"pointer"}})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"描述"},{default:t(()=>[l(r,{type:"textarea",modelValue:o(a).description,"onUpdate:modelValue":e[12]||(e[12]=n=>o(a).description=n),placeholder:"非必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:"参考图片"},{default:t(()=>[l(r,{type:"textarea",modelValue:o(a).images,"onUpdate:modelValue":e[13]||(e[13]=n=>o(a).images=n),placeholder:"非必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:"Git仓库地址"},{default:t(()=>[l(r,{type:"textarea",modelValue:o(a).git,"onUpdate:modelValue":e[14]||(e[14]=n=>o(a).git=n),placeholder:"非必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:""})]),_:1})]),_:1},8,["model"]),s("div",Ve,[l(h,{onClick:e[15]||(e[15]=n=>b.value=!1),size:"mini"},{default:t(()=>e[23]||(e[23]=[f("取 消",-1)])),_:1,__:[23]}),l(h,{type:"primary",onClick:P,size:"mini"},{default:t(()=>e[24]||(e[24]=[f("确 定",-1)])),_:1,__:[24]})])]),_:1},8,["visible"])]),_:1})}}},Ae=J(ve,[["__scopeId","data-v-a36fc82c"]]);export{Ae as default};
