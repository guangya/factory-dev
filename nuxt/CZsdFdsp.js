import{_ as q,u as J,r,f as K,g as U,o as c,w as t,b as l,E as O,i as Q,a as n,j as W,k as S,l as o,d as m,h as X,t as h,n as Y,c as w,m as Z,F as ee}from"./BRIzjCuh.js";import{E as le,a as te,b as oe,c as ae,d as se,e as ne,f as ie}from"./D3JDOc7y.js";import{E as de}from"./C5299zxR.js";import{E as re}from"./CeJHs-1H.js";const ue={style:{color:"black"}},pe=["infinite-scroll-disabled"],me={style:{width:"160px",height:"160px"}},fe=["href"],_e={style:{"line-height":"24px","padding-top":"5px"}},ce={style:{display:"flex",height:"24px","overflow-y":"hidden"}},ge={style:{"flex-grow":"1"}},he={style:{"text-align":"right"}},be={style:{display:"flex"}},ye={key:0},xe={key:1},we={slot:"footer",class:"dialog-footer"},Ve={__name:"index",setup(ve){J({title:"产品集合"});let V=null,v=null;const p=r({_id:"",name:"",owner:"",description:""}),k=r([]),s=r({}),b=r(!1),z=r(!1),D=r(!0);r([]),r(!1);const A=r(!1),E=r(1),I=r(1),P=r(!1);K(async()=>{V=window.browser??window.top.browser,v=V.pouchdb;const u={_id:{$exists:!0}},f=(await v.find("product-albums",{selector:u})).result.docs;k.value=f,console.log(f)});function F(){s.value={_id:"",code:"",path:""},z.value=!0,b.value=!0}async function N(){s.value.code=s.value._id;try{const e=(await axios.post("album/create",this.current)).data;e.ok&&(this.current._rev=e.rev,this.albums.unshift(this.current)),this.$message({type:"success",message:"更新成功"}),this.editFormVisible=!1}catch(u){if(u.name=="conflict"){this.$message({type:"error",message:"相册短代码/ID冲突，请使用新的短代码"});return}return this.$message({type:"error",message:"更新出错，请稍后重试"})}}async function B(){this.currentPage=1,this.isInfiniteScrollDisabled=!1,this.handleLoadAlbums()}async function L(u){this.handleLoadAlbums(u)}async function $(){const u=await axios.get("/dialog/selectDirectory");this.current.path=u.data}async function M(){for(let u in this.params)this.params[u]="";this.currentPage=1,this.handleLoadAlbums()}return(u,e)=>{const f=Q,d=oe,i=te,g=de,y=le,C=W,x=O,H=X,j=se,_=ae,G=ie,R=ne,T=re;return c(),U(x,{style:{height:"100%"},class:"content"},{default:t(()=>[l(H,{width:"270px",style:{"background-color":"white"}},{default:t(()=>[l(x,null,{default:t(()=>[l(f,{height:"39px",style:{"border-bottom":"1px solid #eee",display:"flex","flex-direction":"row"}},{default:t(()=>[e[15]||(e[15]=n("div",{style:{"line-height":"39px","font-size":"14px","flex-grow":"1"}},"产品集合",-1)),n("div",{style:{width:"20px","line-height":"39px"}},[n("i",{onClick:F,class:"el-icon el-icon-plus",style:{"font-size":"16px",cursor:"pointer"}})])]),_:1,__:[15]}),l(C,{style:{padding:"10px 10px 10px 10px"}},{default:t(()=>[l(y,{size:"small",onSubmit:e[3]||(e[3]=S(()=>{},["prevent"])),"label-width":"68px","label-position":"right"},{default:t(()=>[l(i,{label:"集合名称"},{default:t(()=>[l(d,{modelValue:o(p).name,"onUpdate:modelValue":e[0]||(e[0]=a=>o(p).name=a),placeholder:"集合名称或者标题"},null,8,["modelValue"])]),_:1}),l(i,{label:"关联客户"},{default:t(()=>[l(d,{modelValue:o(p).owner,"onUpdate:modelValue":e[1]||(e[1]=a=>o(p).owner=a),placeholder:"客户名称或代码"},null,8,["modelValue"])]),_:1}),l(i,{label:"描述"},{default:t(()=>[l(d,{modelValue:o(p).description,"onUpdate:modelValue":e[2]||(e[2]=a=>o(p).description=a),placeholder:"描述"},null,8,["modelValue"])]),_:1}),l(i,{label:" "},{default:t(()=>[l(g,{plain:"",onClick:B},{default:t(()=>e[16]||(e[16]=[m("搜索",-1)])),_:1,__:[16]}),l(g,{onClick:M},{default:t(()=>e[17]||(e[17]=[m("清空",-1)])),_:1,__:[17]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(x,{style:{"margin-left":"10px"}},{default:t(()=>[l(f,{class:"content-header",id:"frame-header",height:"40px",shadow:"always"},{default:t(()=>[l(_,{span:14},{default:t(()=>[l(y,{inline:!0,size:"small",onSubmit:e[4]||(e[4]=S(()=>{},["prevent"]))},{default:t(()=>[l(i,null,{default:t(()=>[l(j,{small:"",layout:"prev, next","current-page":o(E),onCurrentChange:L,total:100,"page-count":o(I),disabled:o(P)},null,8,["current-page","page-count","disabled"])]),_:1}),l(i,null,{default:t(()=>[n("span",ue,"第 "+h(o(E))+" 页",1)]),_:1})]),_:1})]),_:1}),l(_,{span:10})]),_:1}),l(C,{id:"frame-main",class:Y({loading:o(D)})},{default:t(()=>[n("div",{style:{width:"100%",display:"block",background:"rgb(244, 244, 245)"},"infinite-scroll-distance":"40px","infinite-scroll-disabled":o(A)},[(c(!0),w(ee,null,Z(o(k),(a,ke)=>(c(),U(R,{style:{display:"inline-block",width:"180px",height:"220px","margin-right":"10px","margin-top":"10px"},"body-style":{padding:"10px"}},{default:t(()=>[n("div",me,[n("a",{href:"/product/collection/"+a._id,target:"_blank"},[l(G,{src:a.cover_image,fit:"fill",style:{width:"100%",height:"100%"},lazy:"",crossorigin:"anonymous"},{default:t(()=>e[18]||(e[18]=[n("div",{slot:"placeholder",class:"image-slot"},[m(" 加载中"),n("span",{class:"dot"},"...")],-1)])),_:2,__:[18]},1032,["src"])],8,fe)]),n("div",_e,[n("div",ce,[n("div",ge,h(a.name),1),n("div",he,h(a._id),1)]),n("div",be,[a.updated_at?(c(),w("div",ye,h(a.updated_at.substr(0,10)),1)):(c(),w("div",xe,"1970-01-01")),e[19]||(e[19]=n("div",{style:{"flex-grow":"1",color:"#999","text-align":"right"}},"本地",-1))])])]),_:2},1024))),256)),e[20]||(e[20]=n("div",{style:{width:"100%",height:"10px"}},null,-1))],8,pe)]),_:1},8,["class"])]),_:1}),l(T,{title:"新建相册",visible:o(b),width:"680px"},{default:t(()=>[l(y,{ref:"edit-form",model:o(s),"label-width":"90px",size:"small"},{default:t(()=>[l(_,{span:11},{default:t(()=>[l(i,{label:"短代码"},{default:t(()=>[l(d,{modelValue:o(s)._id,"onUpdate:modelValue":e[5]||(e[5]=a=>o(s)._id=a),placeholder:"必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:"相册名称"},{default:t(()=>[l(d,{modelValue:o(s).name,"onUpdate:modelValue":e[6]||(e[6]=a=>o(s).name=a),placeholder:"必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:"关联客户"},{default:t(()=>[l(d,{modelValue:o(s).owner,"onUpdate:modelValue":e[7]||(e[7]=a=>o(s).owner=a),placeholder:"非必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:"客户公司"},{default:t(()=>[l(d,{modelValue:o(s).owner_company,"onUpdate:modelValue":e[8]||(e[8]=a=>o(s).owner_company=a),placeholder:"非必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:"关联账号"},{default:t(()=>[l(d,{modelValue:o(s).associated_account,"onUpdate:modelValue":e[9]||(e[9]=a=>o(s).associated_account=a),placeholder:"非必填项"},null,8,["modelValue"])]),_:1})]),_:1}),l(_,{span:2},{default:t(()=>e[21]||(e[21]=[m(" ",-1)])),_:1,__:[21]}),l(_,{span:11},{default:t(()=>[l(i,{label:"文件夹"},{default:t(()=>[l(d,{modelValue:o(s).path,"onUpdate:modelValue":e[10]||(e[10]=a=>o(s).path=a),placeholder:"点击右侧按钮选择文件夹",readonly:!0},{default:t(()=>[n("i",{slot:"suffix",title:"选择文件夹",class:"el-icon-folder-opened el-input__icon",onClick:$,style:{cursor:"pointer"}})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"描述"},{default:t(()=>[l(d,{type:"textarea",modelValue:o(s).description,"onUpdate:modelValue":e[11]||(e[11]=a=>o(s).description=a),placeholder:"非必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:"参考图片"},{default:t(()=>[l(d,{type:"textarea",modelValue:o(s).images,"onUpdate:modelValue":e[12]||(e[12]=a=>o(s).images=a),placeholder:"非必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:"Git仓库地址"},{default:t(()=>[l(d,{type:"textarea",modelValue:o(s).git,"onUpdate:modelValue":e[13]||(e[13]=a=>o(s).git=a),placeholder:"非必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:""})]),_:1})]),_:1},8,["model"]),n("div",we,[l(g,{onClick:e[14]||(e[14]=a=>b.value=!1),size:"small"},{default:t(()=>e[22]||(e[22]=[m("取 消",-1)])),_:1,__:[22]}),l(g,{type:"primary",onClick:N,size:"small"},{default:t(()=>e[23]||(e[23]=[m("确 定",-1)])),_:1,__:[23]})])]),_:1},8,["visible"])]),_:1})}}},ze=q(Ve,[["__scopeId","data-v-3b2bd8df"]]);export{ze as default};
