import{_ as J,u as K,r as u,f as O,g as S,o as _,w as t,b as l,E as Q,i as W,a as n,j as X,k as w,l as o,d as c,h as Y,t as h,n as Z,c as V,m as ee,F as le}from"./Xw1c5z8v.js";import{E as te,a as oe,b as ae,c as se,d as ne,e as ie,f as de}from"./DSxSkEsj.js";import{E as re}from"./CoJ6heSZ.js";import{E as ue}from"./BTGzkcao.js";const pe={style:{color:"black"}},me=["infinite-scroll-disabled"],ce={style:{width:"160px",height:"160px"}},fe=["onClick"],_e={style:{"line-height":"24px","padding-top":"5px"}},ge={style:{display:"flex",height:"24px","overflow-y":"hidden"}},he={style:{"flex-grow":"1"}},be={style:{"text-align":"right"}},ye={style:{display:"flex"}},xe={key:0},we={key:1},Ve={slot:"footer",class:"dialog-footer"},ve={__name:"product-album",setup(ke){K({title:"产品集合"});let v=null,k=null;const m=u({_id:"",name:"",owner:"",description:""}),C=u([]),s=u({}),b=u(!1),D=u(!1),z=u(!0);u([]),u(!1);const A=u(!1),E=u(1),$=u(1),I=u(!1);O(async()=>{v=window.browser??window.top.browser,k=v.pouchdb;const d={_id:{$exists:!0}},p=(await k.find("product-albums",{selector:d})).result.docs;C.value=p,console.log(p)});function N(){s.value={_id:"",code:"",path:""},D.value=!0,b.value=!0}async function P(){s.value.code=s.value._id;try{const e=(await axios.post("album/create",this.current)).data;e.ok&&(this.current._rev=e.rev,this.albums.unshift(this.current)),this.$message({type:"success",message:"更新成功"}),this.editFormVisible=!1}catch(d){if(d.name=="conflict"){this.$message({type:"error",message:"相册短代码/ID冲突，请使用新的短代码"});return}return this.$message({type:"error",message:"更新出错，请稍后重试"})}}async function F(){this.currentPage=1,this.isInfiniteScrollDisabled=!1,this.handleLoadAlbums()}async function B(d){this.handleLoadAlbums(d)}function L(d){const e="view/album/detail.html?id="+d._id,p=`${d._id} - ${d.name} - 相册详情`;openNewTab(p,e)}async function M(){const d=await axios.get("/dialog/selectDirectory");this.current.path=d.data}async function H(){for(let d in this.params)this.params[d]="";this.currentPage=1,this.handleLoadAlbums()}return(d,e)=>{const p=W,r=ae,i=oe,g=re,y=te,U=X,x=Q,T=Y,j=ne,f=se,G=de,R=ie,q=ue;return _(),S(x,{style:{height:"100%"},class:"content"},{default:t(()=>[l(T,{width:"270px",style:{"background-color":"white"}},{default:t(()=>[l(x,null,{default:t(()=>[l(p,{height:"39px",style:{"border-bottom":"1px solid #eee",display:"flex","flex-direction":"row"}},{default:t(()=>[e[15]||(e[15]=n("div",{style:{"line-height":"39px","font-size":"14px","flex-grow":"1"}},"产品集合",-1)),n("div",{style:{width:"20px","line-height":"39px"}},[n("i",{onClick:N,class:"el-icon el-icon-plus",style:{"font-size":"16px",cursor:"pointer"}})])]),_:1,__:[15]}),l(U,{style:{padding:"10px 10px 10px 10px"}},{default:t(()=>[l(y,{size:"small",onSubmit:e[3]||(e[3]=w(()=>{},["prevent"])),"label-width":"68px","label-position":"right"},{default:t(()=>[l(i,{label:"集合名称"},{default:t(()=>[l(r,{modelValue:o(m).name,"onUpdate:modelValue":e[0]||(e[0]=a=>o(m).name=a),placeholder:"集合名称或者标题"},null,8,["modelValue"])]),_:1}),l(i,{label:"关联客户"},{default:t(()=>[l(r,{modelValue:o(m).owner,"onUpdate:modelValue":e[1]||(e[1]=a=>o(m).owner=a),placeholder:"客户名称或代码"},null,8,["modelValue"])]),_:1}),l(i,{label:"描述"},{default:t(()=>[l(r,{modelValue:o(m).description,"onUpdate:modelValue":e[2]||(e[2]=a=>o(m).description=a),placeholder:"描述"},null,8,["modelValue"])]),_:1}),l(i,{label:" "},{default:t(()=>[l(g,{plain:"",onClick:F},{default:t(()=>e[16]||(e[16]=[c("搜索",-1)])),_:1,__:[16]}),l(g,{onClick:H},{default:t(()=>e[17]||(e[17]=[c("清空",-1)])),_:1,__:[17]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(x,{style:{"margin-left":"10px"}},{default:t(()=>[l(p,{class:"content-header",id:"frame-header",height:"40px",shadow:"always"},{default:t(()=>[l(f,{span:14},{default:t(()=>[l(y,{inline:!0,size:"small",onSubmit:e[4]||(e[4]=w(()=>{},["prevent"]))},{default:t(()=>[l(i,null,{default:t(()=>[l(j,{small:"",layout:"prev, next","current-page":o(E),onCurrentChange:B,total:100,"page-count":o($),disabled:o(I)},null,8,["current-page","page-count","disabled"])]),_:1}),l(i,null,{default:t(()=>[n("span",pe,"第 "+h(o(E))+" 页",1)]),_:1})]),_:1})]),_:1}),l(f,{span:10})]),_:1}),l(U,{id:"frame-main",class:Z({loading:o(z)})},{default:t(()=>[n("div",{style:{width:"100%",display:"block",background:"rgb(244, 244, 245)"},"infinite-scroll-distance":"40px","infinite-scroll-disabled":o(A)},[(_(!0),V(le,null,ee(o(C),(a,Ce)=>(_(),S(R,{style:{display:"inline-block",width:"180px",height:"220px","margin-right":"10px","margin-top":"10px"},"body-style":{padding:"10px"}},{default:t(()=>[n("div",ce,[n("a",{href:"#",onClick:w(Ee=>L(a),["prevent"])},[l(G,{src:a.cover_image,fit:"fill",style:{width:"100%",height:"100%"},lazy:"",crossorigin:"anonymous"},{default:t(()=>e[18]||(e[18]=[n("div",{slot:"placeholder",class:"image-slot"},[c(" 加载中"),n("span",{class:"dot"},"...")],-1)])),_:2,__:[18]},1032,["src"])],8,fe)]),n("div",_e,[n("div",ge,[n("div",he,h(a.name),1),n("div",be,h(a._id),1)]),n("div",ye,[a.updated_at?(_(),V("div",xe,h(a.updated_at.substr(0,10)),1)):(_(),V("div",we,"1970-01-01")),e[19]||(e[19]=n("div",{style:{"flex-grow":"1",color:"#999","text-align":"right"}},"本地",-1))])])]),_:2},1024))),256)),e[20]||(e[20]=n("div",{style:{width:"100%",height:"10px"}},null,-1))],8,me)]),_:1},8,["class"])]),_:1}),l(q,{title:"新建相册",visible:o(b),width:"680px"},{default:t(()=>[l(y,{ref:"edit-form",model:o(s),"label-width":"90px",size:"small"},{default:t(()=>[l(f,{span:11},{default:t(()=>[l(i,{label:"短代码"},{default:t(()=>[l(r,{modelValue:o(s)._id,"onUpdate:modelValue":e[5]||(e[5]=a=>o(s)._id=a),placeholder:"必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:"相册名称"},{default:t(()=>[l(r,{modelValue:o(s).name,"onUpdate:modelValue":e[6]||(e[6]=a=>o(s).name=a),placeholder:"必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:"关联客户"},{default:t(()=>[l(r,{modelValue:o(s).owner,"onUpdate:modelValue":e[7]||(e[7]=a=>o(s).owner=a),placeholder:"非必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:"客户公司"},{default:t(()=>[l(r,{modelValue:o(s).owner_company,"onUpdate:modelValue":e[8]||(e[8]=a=>o(s).owner_company=a),placeholder:"非必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:"关联账号"},{default:t(()=>[l(r,{modelValue:o(s).associated_account,"onUpdate:modelValue":e[9]||(e[9]=a=>o(s).associated_account=a),placeholder:"非必填项"},null,8,["modelValue"])]),_:1})]),_:1}),l(f,{span:2},{default:t(()=>e[21]||(e[21]=[c(" ",-1)])),_:1,__:[21]}),l(f,{span:11},{default:t(()=>[l(i,{label:"文件夹"},{default:t(()=>[l(r,{modelValue:o(s).path,"onUpdate:modelValue":e[10]||(e[10]=a=>o(s).path=a),placeholder:"点击右侧按钮选择文件夹",readonly:!0},{default:t(()=>[n("i",{slot:"suffix",title:"选择文件夹",class:"el-icon-folder-opened el-input__icon",onClick:M,style:{cursor:"pointer"}})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"描述"},{default:t(()=>[l(r,{type:"textarea",modelValue:o(s).description,"onUpdate:modelValue":e[11]||(e[11]=a=>o(s).description=a),placeholder:"非必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:"参考图片"},{default:t(()=>[l(r,{type:"textarea",modelValue:o(s).images,"onUpdate:modelValue":e[12]||(e[12]=a=>o(s).images=a),placeholder:"非必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:"Git仓库地址"},{default:t(()=>[l(r,{type:"textarea",modelValue:o(s).git,"onUpdate:modelValue":e[13]||(e[13]=a=>o(s).git=a),placeholder:"非必填项"},null,8,["modelValue"])]),_:1}),l(i,{label:""})]),_:1})]),_:1},8,["model"]),n("div",Ve,[l(g,{onClick:e[14]||(e[14]=a=>b.value=!1),size:"small"},{default:t(()=>e[22]||(e[22]=[c("取 消",-1)])),_:1,__:[22]}),l(g,{type:"primary",onClick:P,size:"small"},{default:t(()=>e[23]||(e[23]=[c("确 定",-1)])),_:1,__:[23]})])]),_:1},8,["visible"])]),_:1})}}},Ae=J(ve,[["__scopeId","data-v-161edbab"]]);export{Ae as default};
